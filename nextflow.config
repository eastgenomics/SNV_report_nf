//getting output from mosdepth 
params.pb_bed="" //*per-base.bed.gz from mosdepth output
params.build="" //*build.txt from mosdepth output


//parameters for athena
params.exons_file_name="dx://project-Fkb6Gkj433GVVvj73J7x8KbV:file-GF611Z8433Gf99pBPbJkV7bq" //GCF_000001405.25_GRCh37.p13_genomic.symbols.exon_5bp_v2.0.0.tsv
params.ath_threshold= "10, 20, 30, 50, 100"
params.cutoff_threshold=20
params.ath_panel=true
params.ath_limit=260
params.summary=true
params.outdir3 = "./athena_output"

//parameters for generate_bed 
params.sample_file=""//_Haplotyper.vcf.gz from Sentieon output
params.gene_panels="dx://project-Fkb6Gkj433GVVvj73J7x8KbV:file-GVx0vkQ433Gvq63k1Kj4Y562" //230602_genepanels.tsv
params.exons_nirvana="dx://project-Fkb6Gkj433GVVvj73J7x8KbV:file-GF611Z8433Gk7gZ47gypK7ZZ" //GCF_000001405.25_GRCh37.p13_genomic.exon_5bp_v2.0.0.tsv
params.nirvana_genes2transcripts="dx://project-Fkb6Gkj433GVVvj73J7x8KbV:file-GV4P970433Gj6812zGVBZvB4" //nirvana_genes2transcripts/230421_g2t.tsv
params.flank=495
params.epic_menifest=""
params.outdir1 = "./generate_bed_output"

//parameters for vep
params.fasta = "dx://project-Fkb6Gkj433GVVvj73J7x8KbV:file-G6BYyyj4YV3pYBkgFVGP2K4P" // Homo_sapiens.GRCh37.dna.toplevel.fa.gz
params.fasta_fai="dx://project-Fkb6Gkj433GVVvj73J7x8KbV:file-G6P32kj4YV3y58KyP4k4qG2p" // Homo_sapiens.GRCh37.dna.toplevel.fa.gz.fai
params.fasta_gzi="dx://project-Fkb6Gkj433GVVvj73J7x8KbV:file-G6BYz104YV3X5qp463K5b5vp" // Homo_sapiens.GRCh37.dna.toplevel.fa.gz.gzi
params.ref_bcftools="dx://project-F3zqGV04fXX5j7566869fjFq:file-F3zxG0Q4fXX9YFjP1v5jK9jf" //hs37d5.fasta-index.tar.gz

params.cache_version=107
params.cache_file="dx://project-Fkb6Gkj433GVVvj73J7x8KbV:file-GQ7YF104GV6YQ0B98qyQQP58"
params.plugin_dir="dx://project-Fkb6Gkj433GVVvj73J7x8KbV:/assets/vep/vep_docker_v107.0/"

params.clinvar = "" //file-GXBpzk84b1z1bgzyV6Xj2Jzf clinvar_20230617_b37.vcf.gz
params.clinvar_index = "" //file-GXBpzq04b1z1XYy36z9yYgZK clinvar_20230617_b37.vcf.gz.tbi
params.clinvar_custom_str="ClinVar,vcf,exact,0,CLNSIG,CLNREVSTAT,CLNDN,CLNSIGCONF"

params.hgmd ="" //file-GVKGk184jzBzGB4kkXp62GzK HGMD_Pro_2023.1_hg19.vcf.gz
params.hgmd_index="" //file-GVKGk404jzByPV0X4FjpQJZP HGMD_Pro_2023.1_hg19.vcf.gz.tbi
params.hgmd_custom_str="HGMD,vcf,exact,0,PHEN,RANKSCORE,CLASS"

params.gnomADg ="" //file-G6zvbFj4Kq40Byxg1vkBq6fQ gnomad.genomes.r2.0.1.sites.noVEP_normalised_decomposed_PASS.vcf.gz
params.gnomADg_index="" //file-G6zvbFj4Kq47J4fY1pXGYgbK gnomad.genomes.r2.0.1.sites.noVEP_normalised_decomposed_PASS.vcf.gz.tbi
params.gnomADg_custom_str="gnomADg,vcf,exact,0,AC,AN,AF,Hom"

params.gnomADe ="" //file-G7vj6504kFX7bQyx258v3f1z gnomad.exomes.r2.0.2.sites.noVEP_normalised_decomposed_PASS.vcf.gz
params.gnomADe_index="" //file-G7vj6x04kFX53yZP1kF4x324 gnomad.exomes.r2.0.2.sites.noVEP_normalised_decomposed_PASS.vcf.gz.tbi
params.gnomADe_custom_str="gnomADe,vcf,exact,0,AC,AN,AF,Hom"

params.twe ="" //file-G9FBxGj4kFXPG23VBZKYGkJ7 TWE_POPAF_N500_chr1-22_220413.vcf.gz
params.twe_index="" //file-G9FBxX84kFX3qfjY9QjjXQ9x TWE_POPAF_N500_chr1-22_220413.vcf.gz.tbi
params.twe_custom_str="TWE,vcf,exact,0,AF,AC_Hom,AC_Het,AN"

params.outdir2 = "./vep_output"

params.spliceAI_snv="" //file-G9FFfBj433GV57Zf8ZvxfbBg spliceai_scores.masked.snv.hg19.vcf.gz
params.spliceAI_snv_index="" //file-G9FFfz0433GZ1X13FqjjQJFF spliceai_scores.masked.snv.hg19.vcf.gz.tbi

params.spliceAI_indel="" //file-G9FF6zj433Gv5jxkFqpK6p7J spliceai_scores.masked.indel.hg19.vcf.gz
params.spliceAI_indel_index="" //file-G9FF6qQ433GxvVp497P5V05X spliceai_scores.masked.indel.hg19.vcf.gz.tbi

params.ravel="" //file-G9bybYj433GbyP5X4fPGy2VX revel_b37.tsv.gz
params.ravel_index="" //file-G9bygp8433GQX4f44f2Bqpb5 revel_b37.tsv.gz.tbi

params.cadd_snv="" //file-G5KjGZ84YV3xFfv221vJQjQZ cadd_whole_genome_SNVs_GRCh37.tsv.gz
params.cadd_snv_index="" //file-G5KjKf84YV3y39z97vbXJ60b cadd_whole_genome_SNVs_GRCh37.tsv.gz.tbi

params.cadd_gnomad_genome="" //file-G6BYB5Q433GvQGgF58976p7J gnomad.genomes.r2.1.1.indel.tsv.gz
params.cadd_gnomad_genome_index="" //file-G6BYB8j433GyJ3f13z8GB4ZV gnomad.genomes.r2.1.1.indel.tsv.gz.tbi

params.cadd_indel37="" //file-G9G2KKj4jKX8xxK7975q7XgX InDels_GRCh37.tsv.gz
params.cadd_indel37_index="" //file-G9G2KPj4jKXPG23VBZKYv570 InDels_GRCh37.tsv.gz.tbi

params.field_str="Allele,SYMBOL,HGNC_ID,VARIANT_CLASS,Consequence, \
IMPACT,EXON,INTRON,Feature,HGVSc,HGVSp,HGVS_OFFSET,Existing_variation, \
STRAND,ClinVar,ClinVar_CLNSIG,ClinVar_CLNSIGCONF,ClinVar_CLNDN,gnomADg_AC, \
gnomADg_AN,gnomADg_AF,gnomADe_AC,gnomADe_AN,gnomADe_AF,gnomADe_Hom,TWE_AF, \
TWE_AC_Hom,TWE_AC_Het,TWE_AN,HGMD,HGMD_PHEN,HGMD_CLASS,HGMD_RANKSCORE, \
SpliceAI_pred_DS_AG,SpliceAI_pred_DS_AL,SpliceAI_pred_DS_DG,SpliceAI_pred_DS_DL, \
SpliceAI_pred_DP_AG,SpliceAI_pred_DP_AL,SpliceAI_pred_DP_DG,SpliceAI_pred_DP_DL,REVEL,CADD_PHRE"
params.buffer_size=500

//parameters for generate_variant_workbook
params.exclude_columns="BaseQRankSum ClippingRankSum DB ExcessHet  \
FS MLEAC MLEAF MQ MQRankSum QD ReadPosRankSum SOR PL QUAL ID FILTER \
CSQ_ClinVar_CLNSIGCONF CSQ_Allele CSQ_HGNC_ID DP AC AF AN \
CSQ_SpliceAI_pred_DP_AL CSQ_SpliceAI_pred_DP_AG CSQ_SpliceAI_pred_DP_DG CSQ_SpliceAI_pred_DP_DL"

params.acmg=true
params.rename_columns="CSQ_Feature=Transcript DP_FMT=DP"
params.add_comment_column=true
params.keep_tmp=true
params.reorder_columns="CHROM POS REF ALT GT GQ DP_FMT AD CSQ_SYMBOL \
CSQ_EXON CSQ_INTRON CSQ_HGVSc CSQ_HGVSp CSQ_Consequence CSQ_IMPACT \
 CSQ_VARIANT_CLASS CSQ_gnomADe_AF CSQ_gnomADe_Hom CSQ_gnomADe_AC \
  CSQ_gnomADe_AN CSQ_gnomADg_AF CSQ_gnomADg_AC CSQ_gnomADg_AN \
  CSQ_TWE_AF CSQ_TWE_AC_Hom CSQ_TWE_AC_Het CSQ_TWE_AN CSQ_HGMD \
  CSQ_HGMD_CLASS CSQ_HGMD_RANKSCORE CSQ_HGMD_PHEN CSQ_Existing_variation \
   CSQ_ClinVar CSQ_ClinVar_CLNDN CSQ_ClinVar_CLNSIG CSQ_Mastermind_MMID3 \
    CSQ_CADD_PHRED CSQ_REVEL CSQ_SpliceAI_pred_DS_AG \
    CSQ_SpliceAI_pred_DS_AL CSQ_SpliceAI_pred_DS_DG CSQ_SpliceAI_pred_DS_DL CSQ_HGVS_OFFSET CSQ_STRAND CSQ_Feature"
    
params.human_filter="excluded gnomAD exomes / genomes > 1%, TWE > 5%, \
synonymous / intronic / intergenic / upstream / downstream / UTRs EXCEPT \
pathogenic status in ClinVar OR DM in HGMD Class"
params.summary="dias"
params.keep_filtered=true
params.outdir4 = "./workbook_output"

//docker
process {

  withName:athena {
        container = 'wintun12/fordnanexus:athena_python'
  }
  
  withName:generate_bed_athena {
        container = 'wintun12/fordnanexus:panda_numpy'
  }
  withName:vep {
        container = 'ensemblorg/ensembl-vep:release_110.1'
  }
  
  withName:filter_after_annotation {
        container = 'ensemblorg/ensembl-vep:release_110.1'
  }
  
  withName:generate_bed {
        container = 'wintun12/fordnanexus:panda_numpy'
  }
     
  withName:getting_panel_for_bed {
        container = 'wintun12/fordnanexus:panda_numpy'
  }
  withName:generate_variannt_workbook {
        container = 'wintun12/fordnanexus:workbook_python'
  }
      
}
docker {
    enabled = true
}

//docker.runOptions = '-u $(id -u):$(id -g)'
docker.runOptions = '-u $(id -u):$(id -g) --env-file <(env | grep "DX_JOB_ID")'

//machine type
process {

    withName:athena {
        machineType = 'mem1_ssd1_v2_x16'
   }
     
     withName:generate_bed_athena {
        machineType = 'mem1_ssd1_v2_x4'
   }
    
    withName:filter_b4_annotation {
        machineType = 'mem1_ssd1_v2_x16'
  }
    withName:normalise {
        machineType = 'mem1_ssd1_v2_x16'
  }
  
    withName:vep {
        machineType = 'mem1_ssd1_v2_x16'
  }
  
    withName:generate_transcript {
        machineType = 'mem1_ssd1_v2_x16'
  }
  
    withName:filter_after_annotation {
        machineType = 'mem1_ssd1_v2_x16'
  }
  
    withName:generate_bed {
        machineType = 'mem1_ssd1_v2_x4'
  }
     
   withName:getting_panel_for_bed {
        machineType = 'mem1_ssd1_v2_x4'
  }
     
  withName:generate_variannt_workbook {
        machineType = 'mem1_ssd1_v2_x4'
     }
}

executor {
    queueSize = 99
}
